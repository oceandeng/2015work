<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>邀请好友</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no,email=no">
<meta name="full-screen" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="stylesheet" href="styles/main.css">

<script>
	var gConfig = {
		imgPath: location.origin + '/',
		prizeURL: 'http://192.168.8.72/interface/award.php'
	}
</script>

</head>
<body>
<header>
	<div class="invite-tips">邀请您的朋友们一起帮忙拆红包吧！</div>
</header>

<article class="container">
	<div id="addMobile" class="add-mobile">+ 添加手机号</div>
	<!-- 上传通讯录 S -->
	<div id="uploadList" class="upload-list" data-href="">上传通讯录，邀请更方便</div>
	<!-- 上传通讯录 E -->


	<section id="inviteList">
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>
		<div class="invite-list">
			<div class="row">
				<div class="span4">
					<div class="i-name">好友昵称</div>
				</div>
				<div class="span6">
					<div class="i-num">
						13800138000
					</div>
				</div>
				<div class="span2" data-iid="1">
					<div class="i-sel"></div>
				</div>
			</div>
		</div>

	</section>

</article>

<section class="body-bg"><img src="images/bg.jpg" alt=""></section>
<footer>
	<div id="sendInvite" class="send-invite">
		<p>发布邀请</p>
		<span>（选中<b id="people">0</b>人）</span>
	</div>
</footer>

<script src="scripts/zepto.min.js"></script>
<script src="scripts/custom.min.js"></script>
<script src="scripts/main.js"></script>

<script>
	$(function(){
// -- 填手机号邀请
		$('#addMobile').on(oTools.clickEvent, function(){
			inviteDialog(exchange);
		});

		function exchange(popup){
		        var mobile = $("#inviteNum").val();
		        if (mobile == '') {
		            oTools.alertmess("请输入手机号码");
		            return false;
		        }
		        var regu = /^[1][0-9]{10}$/;
		        var re = new RegExp(regu);

		        if (!re.test(mobile)) {
		            oTools.alertmess("请输入正确手机号码");
		            return false;
		        }

		        var submitData = {
		            mobile: mobile,
		        };

				$.ajax({
		            type: 'POST',
		            url: 'http://192.168.8.72/interface/success.php?ac=activityuser',
		            dataType: 'json',
		            timeout: 6e3,
		            async: false,
		            data: {},
		            beforeSend: function(){
						load.start();
		            },
		            success: function(res){
						load.close();
						if (res.success == true) {
			                oTools.alertmess("提交成功，谢谢您的参与");

			            var html = '<div class="invite-list"><div class="row">';
							html += '<div class="row"><div class="span4">';
							html += '<div class="i-name">' + res.username + '</div></div>';
							html += '<div class="span6"><div class="i-num">' + res.mobile + '</div></div>';
							html += '<div class="span2" data-iid="1"><div class="i-sel"></div></div></div>';
										
				            $('#inviteList').append(html);

			                return true;
			            } else {
			            	oTools.alertmess(res.msg);
			            	return false;
			            }
		            },
		            error: function(XMLHttpRequest, textStatus, errorThrown) {
						load.close();
		            	return false;
		            }
		        });
		}
	});

// -- 点击选中

	var peopleNum = 0;

	$('#inviteList').on(oTools.clickEvent, '.invite-list', function(){
		var $this = $(this),
			$img = $this.find('.i-sel');

		var selImg = new Image();
		selImg.onload = function(){
			if($this.data('selectd')){
				$img.empty();
				$this.data('selectd', 'false');
				peopleNum == 0 ? peopleNum : peopleNum -= 1;
			}else{
				$img.append(selImg);
				$this.data('selectd', 'true');
				peopleNum += 1;
			};
			$('#people').text(peopleNum);
		}
		selImg.src = gConfig.imgPath + 'images/selected.png';

	});

// -- 发送邀请按钮
	$('#sendInvite').on(oTools.clickEvent, function(){

		var $list = $('#inviteList').find('.invite-list');
		var mobileArr = [];

		$list.each(function(k, v){
			if($(v).data('selectd')){
				mobileArr.push($(v).find('.i-num').text());
			}
		});

		$.ajax({
            type: 'POST',
            url: gConfig.prizeURL,
            dataType: 'json',
            timeout: 6e3,
            // async: false,
            data: {mobile: mobileArr},
            beforeSend: function(){
				load.start();
            },
            success: function(res){
				load.close();




            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
				load.close();
            }
        });
	});

</script>

</body>
</html>